# n8n Супер-агент

Проект "n8n Супер-агент" - это мощная система на базе n8n с использованием Docker и Docker Compose. Система реализует концепцию "супер-агента" с динамическими промптами, классификатором текста, специализированными рабочими процессами и модулем памяти для создания эффективного и экономичного ИИ-агента.

## Компоненты системы

1. **n8n** - основной сервис для выполнения workflows
2. **PostgreSQL** - база данных для n8n и Zep
3. **Zep** - сервис для хранения памяти агента
4. **Redis** - кэширование запросов и результатов
5. **Embeddings Service** - локальные эмбеддинги на базе Sentence Transformers
6. **Weaviate** - векторная база данных для семантического поиска
7. **NGINX** - обратный прокси с SSL/TLS

## Предварительные требования

- Docker и Docker Compose
- Доступ к OpenAI API (для генерации текста)
- Другие API-ключи для необходимых вам сервисов (опционально)

## Структура проекта

```
n8n-super-agent/
├── docker-compose.yml      # Конфигурация Docker Compose
├── .env                    # Файл с переменными окружения
├── .env.example           # Пример .env файла
├── postgres-custom.conf    # Оптимизированная конфигурация PostgreSQL
├── zep-config.yaml         # Конфигурация для Zep
├── setup.sh                # Скрипт установки и инициализации
├── lib/                    # Библиотеки и утилиты
│   ├── weaviate-schema.js  # Схема Weaviate
│   └── weaviate-client.js  # Клиент для работы с Weaviate
├── workflows/              # n8n workflows
│   ├── prompts/            # Промпты для агента
│   └── templates/          # Шаблоны workflows
├── nginx/                  # Конфигурация NGINX
│   ├── conf.d/             # Конфигурационные файлы
│   └── certs/              # SSL сертификаты
└── logs/                   # Логи сервисов
    ├── n8n/                # Логи n8n
    ├── zep/                # Логи Zep
    └── ...                 # Другие логи
```

## Установка и запуск

1. Клонируйте репозиторий:

```bash
git clone https://github.com/yourusername/n8n-super-agent.git
cd n8n-super-agent
```

2. Настройте файл `.env`:

```bash
cp .env.example .env
# Отредактируйте .env файл, добавив ваши API ключи
```

3. Запустите скрипт установки:

```bash
chmod +x setup.sh
./setup.sh
```

4. Откройте n8n по адресу https://localhost и войдите с учетными данными из файла .env.

## Управление через Make

Проект поддерживает удобное управление через make-команды. После установки Makefile используйте следующие команды:

### Основные команды:

```bash
make setup      # Инициализация проекта (первый запуск)
make start      # Запуск контейнеров
make stop       # Остановка контейнеров
make restart    # Перезапуск контейнеров
make status     # Проверка статуса системы
make check      # Проверка работоспособности системы
make fix        # Применение исправлений
```

### Мониторинг и логи:

```bash
make logs        # Просмотр логов всех контейнеров
make n8n-logs    # Логи только n8n
make redis-logs  # Логи только Redis
make zep-logs    # Логи только Zep
```

### Обслуживание системы:

```bash
make backup     # Создание резервной копии данных
make restore    # Восстановление из резервной копии
make clean      # Остановка и удаление контейнеров без удаления данных
make reset      # Сброс проекта (удаление контейнеров и томов)
make update     # Обновление образов контейнеров
```

### Разработка:

```bash
make dev        # Запуск проекта в режиме разработки
make test       # Запуск тестов
make shell      # Подключение к консоли контейнера n8n
```

Для получения полного списка доступных команд используйте:

```bash
make help
```

## Ключевые функции

### 1. Динамический промпт
Короткий основной промпт, ссылающийся на другие специализированные промпты. Такой подход значительно снижает количество используемых токенов и уменьшает вероятность "галлюцинаций" ИИ.

### 2. Классификатор текста
Определяет тип запроса и направляет его в соответствующий специализированный рабочий процесс.

### 3. Специализированные рабочие процессы
Оптимизированные workflows для конкретных задач с собственными, точно настроенными промптами.

### 4. Модуль памяти (Zep)
Хранит историю взаимодействий и контекст разговора для более релевантных ответов.

### 5. Оптимизация и кэширование
Улучшение производительности через кэширование Redis и оптимизацию баз данных.

### 6. Семантический поиск (Weaviate)
Поиск релевантной информации на основе векторной близости и гибридных запросов.

### 7. Локальные эмбеддинги
Снижение затрат на API путем локальной генерации эмбеддингов.

## Расширение функциональности

Вы можете расширить функциональность супер-агента, добавив:
1. Новые категории в классификатор текста
2. Специализированные промпты для новых типов запросов
3. Дополнительные инструменты и API-интеграции
4. Рабочие процессы для обработки специфических задач

## Советы по оптимизации

1. **Оптимизация промптов**: Регулярно анализируйте и оптимизируйте промпты для уменьшения использования токенов
2. **Мониторинг ресурсов**: Следите за использованием ресурсов и масштабируйте сервисы при необходимости
3. **Резервное копирование**: Регулярно создавайте резервные копии баз данных и конфигураций (`make backup`)
4. **Обновление компонентов**: Периодически обновляйте компоненты системы для получения новых возможностей и исправлений (`make update`)

## Лицензия

[MIT License](LICENSE)
